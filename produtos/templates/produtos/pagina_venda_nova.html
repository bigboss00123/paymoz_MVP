<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ produto.titulo_seo|default:produto.nome }} - Paymoz</title>
    <meta name="description" content="{{ produto.descricao_seo|default:produto.descricao_curta }}">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .gradient-text {
            background: linear-gradient(135deg, #4f46e5, #7c3aed, #db2777);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .cta-button {
            background: linear-gradient(135deg, #6d28d9, #4f46e5);
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.5);
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px -5px rgba(79, 70, 229, 0.6);
        }
        [x-cloak] { display: none !important; }
        {{ produto.css_customizado|safe }}
    </style>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    {% if produto.facebook_pixel_id %}
    <!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '{{ produto.facebook_pixel_id }}');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id={{ produto.facebook_pixel_id }}&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->
    {% endif %}
</head>
<body class="bg-gray-50 text-gray-800 antialiased">

    <!-- ANNOUNCEMENT BAR -->
    {% if produto.gatilhos_mentais.escassez.texto %}
    <div class="bg-indigo-600 text-white text-center p-3 text-sm font-semibold">
        <span>üî• {{ produto.gatilhos_mentais.escassez.texto }}</span>
        {% if produto.gatilhos_mentais.escassez.data_fim %}
        <span class="ml-2 font-mono" x-data="countdown('{{ produto.gatilhos_mentais.escassez.data_fim }}')" x-text="timeLeft" x-init="start()"></span>
        {% endif %}
    </div>
    {% endif %}

    <!-- HEADER -->
    <header class="bg-gray-50/80 backdrop-blur-lg sticky top-0 z-40 border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gray-800 rounded-lg flex items-center justify-center font-bold text-white text-lg">{{ produto.titulo_cabecalho|default:produto.nome|first|upper }}</div>
                    <span class="font-bold text-xl text-gray-800">{{ produto.titulo_cabecalho|default:produto.nome }}</span>
                </div>
                <a href="#checkout" class="hidden md:inline-block px-6 py-2 text-sm font-semibold text-white bg-gray-800 rounded-lg hover:bg-gray-900 transition-colors">
                    {% if produto.categoria == 'CURSO_ONLINE' or produto.categoria == 'CONSULTORIA' %}
                        Garantir minha vaga
                    {% else %}
                        Comprar agora
                    {% endif %}
                </a>
            </div>
        </div>
    </header>

    <main>
        <!-- HERO SECTION -->
        <section class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-left">
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-tight mb-4">
                            {{ produto.nome|safe }}
                        </h1>
                        <p class="text-lg md:text-xl text-gray-600 mb-8">
                            {{ produto.descricao_curta|safe }}
                        </p>
                        <a href="#checkout" class="cta-button inline-block px-10 py-4 text-lg font-bold text-white rounded-xl">
                            {% if produto.categoria == 'CURSO_ONLINE' or produto.categoria == 'CONSULTORIA' %}
                                QUERO GARANTIR MINHA VAGA
                            {% else %}
                                QUERO COMPRAR AGORA
                            {% endif %}
                        </a>
                        {% if produto.gatilhos_mentais.guarantee.dias %}
                        <p class="text-sm text-gray-500 mt-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944a11.954 11.954 0 007.834 3.055A12.002 12.002 0 0119 9c0 5.592-3.824 10.29-9 11.622C4.824 19.29 1 14.592 1 9c0-1.04.134-2.052.382-3.016.572-2.286 1.747-4.186 1.784-4.985zM10 16a6 6 0 100-12 6 6 0 000 12zm-1-6a1 1 0 10-2 0v1a1 1 0 102 0v-1zm1-3a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1z" clip-rule="evenodd" />
                            </svg>
                            Garantia incondicional de {{ produto.gatilhos_mentais.guarantee.dias }} dias.
                        </p>
                        {% endif %}
                    </div>
                    <div>
                        {% if produto.video_url %}
                        <div class="relative overflow-hidden rounded-2xl shadow-2xl transform hover:scale-105 transition-transform duration-500" style="padding-top: 56.25%;">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="{{ produto.video_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        {% elif produto.imagem_destaque %}
                        <img src="{{ produto.imagem_destaque.url }}" alt="{{ produto.nome }}" class="w-full h-auto object-cover rounded-2xl shadow-2xl transform hover:scale-105 transition-transform duration-500">
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- SOCIAL PROOF / TESTIMONIALS -->
        {% if produto.depoimentos %}
        <section class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                        O que nossos <span class="gradient-text">clientes dizem</span>
                    </h2>
                    <p class="text-lg text-gray-600 mt-2">Resultados reais de pessoas como voc√™.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {% for avaliacao in produto.depoimentos|slice:":3" %}
                    <div class="bg-gray-50 p-8 rounded-2xl shadow-sm">
                        <div class="flex mb-4">
                            {% for i in "x"|rjust:avaliacao.rating %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                            {% endfor %}
                        </div>
                        <p class="text-gray-700 italic mb-6">"{{ avaliacao.texto }}"</p>
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mr-4">
                                <span class="font-bold text-gray-600">{{ avaliacao.autor|first|upper }}</span>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900">{{ avaliacao.autor }}</p>
                                <p class="text-sm text-gray-500">{{ avaliacao.profissao }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- WHAT'S INCLUDED -->
        {% if produto.itens_incluidos.all %}
        <section class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                        {% if produto.categoria == 'CURSO_ONLINE' %}
                            O que voc√™ vai <span class="gradient-text">aprender</span>
                        {% elif produto.categoria == 'EBOOK' %}
                            O que voc√™ encontrar√° <span class="gradient-text">neste e-book</span>
                        {% else %}
                            Tudo que voc√™ vai <span class="gradient-text">receber</span>
                        {% endif %}
                    </h2>
                    <p class="text-lg text-gray-600 mt-2">Uma vis√£o completa do que te espera.</p>
                </div>
                <div class="max-w-3xl mx-auto grid md:grid-cols-2 gap-6">
                    {% for item in produto.itens_incluidos.all %}
                    <div class="flex items-start space-x-4 p-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        </div>
                        <p class="text-lg text-gray-700">{{ item.descricao }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- PRODUCT DESCRIPTION -->
        <section class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4">
                <div class="max-w-3xl mx-auto prose lg:prose-xl text-gray-700">
                    {{ produto.descricao|safe }}
                </div>
            </div>
        </section>

        <!-- ABOUT THE CREATOR -->
        {% if produto.sobre_o_criador %}
        <section class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="max-w-3xl mx-auto text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-12">
                        Sobre <span class="gradient-text">o Criador</span>
                    </h2>
                    <div class="flex flex-col items-center">
                        {% if produto.foto_criador %}
                        <img src="{{ produto.foto_criador.url }}" alt="{{ produto.user_profile.user.get_full_name|default:produto.user_profile.user.username }}" class="w-32 h-32 rounded-full shadow-xl mb-6">
                        {% endif %}
                        <h3 class="text-2xl font-bold text-gray-800">{{ produto.user_profile.user.get_full_name|default:produto.user_profile.user.username }}</h3>
                        <div class="prose mt-4 text-gray-600">
                            <p>{{ produto.sobre_o_criador }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- GALLERY SECTION -->
        {% if produto.imagens_galeria.all %}
        <section class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                        Veja por <span class="gradient-text">Dentro</span>
                    </h2>
                    <p class="text-lg text-gray-600 mt-2">Explore mais detalhes do produto.</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 max-w-5xl mx-auto">
                    {% for imagem in produto.imagens_galeria.all %}
                    <a href="{{ imagem.imagem.url }}" data-fancybox="gallery" class="block rounded-lg overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300">
                        <img src="{{ imagem.imagem.url }}" alt="{{ imagem.legenda|default:produto.nome }}" class="w-full h-48 object-contain object-center">
                    </a>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- FAQ SECTION -->
        {% if produto.faq %}
        <section class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                        Perguntas <span class="gradient-text">Frequentes</span>
                    </h2>
                    <p class="text-lg text-gray-600 mt-2">Ainda tem d√∫vidas? A gente responde.</p>
                </div>
                <div class="max-w-3xl mx-auto space-y-4">
                    {% for item in produto.faq %}
                    <div class="bg-white rounded-xl shadow-sm" x-data="{ open: false }">
                        <button @click="open = !open" class="w-full flex justify-between items-center text-left p-6">
                            <span class="text-lg font-semibold text-gray-800">{{ item.pergunta }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 transition-transform" :class="{'rotate-180': open}" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                        <div x-show="open" x-cloak class="p-6 pt-0 text-gray-600">
                            <p>{{ item.resposta }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- CHECKOUT SECTION -->
        <section id="checkout" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-8 md:p-12">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                            {% if produto.categoria == 'CURSO_ONLINE' or produto.categoria == 'CONSULTORIA' %}
                                Garanta sua <span class="gradient-text">vaga agora</span>
                            {% else %}
                                Adquira j√° o seu <span class="gradient-text">acesso</span>
                            {% endif %}
                        </h2>
                        <p class="text-lg text-gray-600 mt-2">√öltimo passo para transformar seus resultados.</p>
                    </div>

                    <div class="bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6 mb-8 text-center">
                        <p class="text-lg text-gray-600">Voc√™ est√° comprando:</p>
                        <p class="text-xl font-bold text-gray-900">{{ produto.nome }}</p>
                        <div class="text-4xl font-extrabold text-indigo-600 my-4">
                            {% if produto.preco_oferta %}
                                <span class="text-2xl text-gray-500 line-through mr-2">{{ produto.preco|floatformat:2 }} MZN</span>
                                <span>{{ produto.preco_oferta|floatformat:2 }} MZN</span>
                            {% else %}
                                <span>{{ produto.preco|floatformat:2 }} MZN</span>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-500">Pagamento √∫nico e seguro</p>
                    </div>

                    <form action="{% url 'produtos:processar_venda_produto' produto.id %}" method="POST" class="space-y-6">
                        {% csrf_token %}
                        <div>
                            <label for="numero_celular" class="text-sm font-bold text-gray-700 mb-2 block">Seu n√∫mero de WhatsApp (com c√≥digo do pa√≠s)</label>
                            <input type="tel" id="numero_celular" name="numero_celular" required placeholder="Ex: +25884xxxxxxx ou 25884xxxxxxx" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <p class="text-xs text-gray-500 mt-1">Por favor, inclua o c√≥digo do pa√≠s (ex: +258 para Mo√ßambique). Voc√™ receber√° os detalhes da compra e o acesso ao produto neste n√∫mero.</p>
                        </div>

                        <div>
                            <label for="email_cliente" class="text-sm font-bold text-gray-700 mb-2 block">Seu E-mail</label>
                            <input type="email" id="email_cliente" name="email_cliente" required placeholder="seu.email@exemplo.com" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <p class="text-xs text-gray-500 mt-1">Voc√™ tamb√©m receber√° os detalhes da compra e o acesso ao produto neste e-mail.</p>
                        </div>

                        {% for campo in produto.campos_personalizados %}
                        <div>
                            <label for="custom_{{ campo.label|slugify }}" class="text-sm font-bold text-gray-700 mb-2 block">{{ campo.label }}</label>
                            <input type="{{ campo.tipo }}" id="custom_{{ campo.label|slugify }}" name="custom_{{ campo.label|slugify }}" {% if campo.obrigatorio %}required{% endif %} placeholder="Digite {{ campo.label|lower }}" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        {% endfor %}

                        <div>
                            <button type="submit" class="cta-button w-full py-4 text-xl font-bold text-white rounded-xl flex items-center justify-center">
                                {% if produto.categoria == 'CURSO_ONLINE' or produto.categoria == 'CONSULTORIA' %}
                                    FINALIZAR INSCRI√á√ÉO
                                {% else %}
                                    FINALIZAR COMPRA
                                {% endif %}
                            </button>
                        </div>

                        <div class="text-center text-sm text-gray-500 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 002.166 4.999A12.002 12.002 0 001 9c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.04-.134-2.052-.382-3.016A11.954 11.954 0 0010 1.944zM9 10a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-5a1 1 0 10-2 0v1a1 1 0 102 0v-1zm1-4a1 1 0 11-2 0V6a1 1 0 112 0v3z" /></svg>
                            <span>Ambiente 100% seguro e criptografado.</span>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-800 text-gray-400 py-12">
        <div class="container mx-auto px-4 text-center">
            <p class="font-semibold text-gray-200">Vendido por: {{ produto.user_profile.user.get_full_name|default:produto.user_profile.user.username }}</p>
            <p class="text-sm mt-4">&copy; {% now "Y" %} Paymoz. Todos os direitos reservados.</p>
            <p class="text-xs mt-2">Uma plataforma de pagamentos segura e confi√°vel.</p>
        </div>
    </footer>

    <script>
        function countdown(endDate) {
            return {
                endDate: new Date(endDate),
                timeLeft: '',
                start() {
                    this.updateTime();
                    setInterval(() => {
                        this.updateTime();
                    }, 1000);
                },
                updateTime() {
                    const now = new Date();
                    const diff = this.endDate - now;

                    if (diff <= 0) {
                        this.timeLeft = "Oferta Expirada!";
                        return;
                    }

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    this.timeLeft = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                }
            }
        }
    </script>

</body>
</html>